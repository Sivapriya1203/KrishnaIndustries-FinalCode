import{x as Z,y as J,j as e,r as s,c as g,d as x,T as R,G as y,a4 as n,F as U,I as Y,a7 as B,a5 as P,h as p,X as Ne,Y as ke,Z as Ee,$ as Me,a0 as L,a1 as a,a2 as _e,g as z,a6 as $e,a9 as we,U as H,V,W as Q,ad as qe,a3 as X}from"./index-14iq4arv.js";import Ae from"./UploadExell-DYIiZwSx.js";import{P as Oe}from"./Pagination-Drt3pWZO.js";var G={},Re=J;Object.defineProperty(G,"__esModule",{value:!0});var K=G.default=void 0,Ue=Re(Z()),Ye=e;K=G.default=(0,Ue.default)((0,Ye.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete");var N={},Be=J;Object.defineProperty(N,"__esModule",{value:!0});var ee=N.default=void 0,Le=Be(Z()),ze=e;ee=N.default=(0,Le.default)((0,ze.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit");const Ze=()=>{const[te,ae]=s.useState([]),[re,C]=s.useState(!1),[k,se]=s.useState([]),[S,E]=s.useState(!1),[ne,le]=s.useState(null),[ie,c]=s.useState(!1),[oe,d]=s.useState(""),[ce,m]=s.useState("success"),[de,M]=s.useState(!1),[ue,_]=s.useState(null),[r,u]=s.useState({productName:"",productId:"",specification:"",quantity:"",price:"",gst:"",cgst:"",sgst:"",totalPrice:"",totalPriceWithGST:"",fromName:"",address:"",street:"",city:"",state:"",pinCode:""}),[$,he]=s.useState(""),[v,me]=s.useState(""),[b,ge]=s.useState(""),[T,j]=s.useState(1),[W,He]=s.useState(5);s.useEffect(()=>{F()},[]);const F=async()=>{try{const t=await g.get(`${x.apiUrl}/purchase/purchases`);ae(t.data)}catch(t){console.error("Error fetching purchases:",t)}};s.useEffect(()=>{g.get(`${x.apiUrl}/product/getProductData`).then(t=>{se(t.data)}).catch(t=>{console.error("Error fetching products:",t),d("Failed to fetch products"),m("error"),c(!0)})},[]);const xe=()=>{C(!0),E(!1)},pe=t=>{u({productName:t.productName,productId:t.productId,specification:t.specification,quantity:t.quantity,price:t.price,gst:t.gst,cgst:t.cgst,sgst:t.sgst,totalPrice:t.totalPrice,totalPriceWithGST:t.totalPriceWithGST,fromName:t.fromName,address:t.address,street:t.street,city:t.city,state:t.state,pinCode:t.pinCode}),E(!0),le(t.id),C(!0)},D=()=>{C(!1),je()},je=()=>{u({productName:"",productId:"",specification:"",quantity:"",price:"",gst:"",cgst:"",sgst:"",totalPrice:"",totalPriceWithGST:"",fromName:"",address:"",street:"",city:"",state:"",pinCode:""})},i=t=>{const{name:l,value:o}=t.target;if(u(h=>({...h,[l]:o})),l==="gst"||l==="quantity"||l==="price"){const h=parseFloat(r.gst)||0,Fe=parseFloat(r.quantity)||0,De=parseFloat(r.price)||0,I=(Fe*De).toFixed(2),A=(I*(h/100)).toFixed(2),O=(A/2).toFixed(2),Ie=O;u(Ge=>({...Ge,gst:h,cgst:O,sgst:Ie,totalPrice:I,totalPriceWithGST:(parseFloat(I)+parseFloat(A)).toFixed(2)}))}},fe=async()=>{try{S?(await g.put(`${x.apiUrl}/purchase/purchases/${ne}`,r),d("Purchase updated successfully!")):(await g.post(`${x.apiUrl}/purchase/purchases`,r),d("Purchase added successfully!")),m("success"),c(!0),F(),D()}catch(t){console.error("Error submitting purchase data:",t),d("Error adding/updating purchase. Please try again."),m("error"),c(!0)}},ye=t=>{_(t),M(!0)},f=()=>{M(!1),_(null)},Pe=async()=>{try{await g.delete(`${x.apiUrl}/purchase/purchases/${ue}`),d("Purchase deleted successfully!"),m("success"),c(!0),F(),f()}catch(t){console.error("Error deleting purchase:",t),d("Error deleting purchase. Please try again."),m("error"),c(!0),f()}},w=(t,l)=>{l!=="clickaway"&&c(!1)},Ce=t=>{he(t.target.value),j(1)},Se=t=>{me(t.target.value),j(1)},ve=t=>{ge(t.target.value),j(1)},q=()=>te.filter(t=>{const l=t.productName.toLowerCase().includes($.toLowerCase()),o=v?new Date(t.created_at).getMonth()+1===parseInt(v):!0,h=b?new Date(t.created_at).getFullYear()===parseInt(b):!0;return l&&o&&h}),be=(t,l)=>{j(l)},Te=Math.ceil(q().length/W),We=q().slice((T-1)*W,T*W);return e.jsxs(e.Fragment,{children:[e.jsx(R,{variant:"h1",align:"center",marginTop:"13px",gutterBottom:!0,children:"Purchase Index"}),e.jsxs(y,{container:!0,spacing:2,style:{marginBottom:"20px"},children:[e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsx(n,{label:"Search",variant:"outlined",value:$,onChange:Ce,fullWidth:!0})}),e.jsx(y,{item:!0,xs:6,sm:3,children:e.jsxs(U,{fullWidth:!0,variant:"outlined",children:[e.jsx(Y,{children:"Month"}),e.jsxs(B,{value:v,onChange:Se,label:"Month",children:[e.jsx(P,{value:"",children:e.jsx("em",{children:"All"})}),[...Array(12).keys()].map(t=>e.jsx(P,{value:t+1,children:t+1},t+1))]})]})}),e.jsx(y,{item:!0,xs:6,sm:3,children:e.jsxs(U,{fullWidth:!0,variant:"outlined",children:[e.jsx(Y,{children:"Year"}),e.jsxs(B,{value:b,onChange:ve,label:"Year",children:[e.jsx(P,{value:"",children:e.jsx("em",{children:"All"})}),[2020,2021,2022,2023,2024].map(t=>e.jsx(P,{value:t,children:t},t))]})]})})]}),e.jsx(p,{variant:"contained",color:"primary",onClick:xe,children:"New Purchase"}),e.jsx(Ae,{}),e.jsx(Ne,{component:ke,style:{marginTop:"20px"},children:e.jsxs(Ee,{children:[e.jsx(Me,{children:e.jsxs(L,{children:[e.jsx(a,{children:"Product Name"}),e.jsx(a,{children:"Specification"}),e.jsx(a,{children:"Quantity"}),e.jsx(a,{children:"Price Per Piece"}),e.jsx(a,{children:"CGST"}),e.jsx(a,{children:"SGST"}),e.jsx(a,{children:"Total GST"}),e.jsx(a,{children:"Total Price (Without GST)"}),e.jsx(a,{children:"Total Price (With GST)"}),e.jsx(a,{children:"From"}),e.jsx(a,{children:"Address"}),e.jsx(a,{children:"Actions"})," "]})}),e.jsx(_e,{children:We.map(t=>e.jsxs(L,{children:[e.jsx(a,{children:t.productName}),e.jsx(a,{children:t.specification}),e.jsx(a,{children:t.quantity}),e.jsx(a,{children:t.price}),e.jsx(a,{children:t.cgst}),e.jsx(a,{children:t.sgst}),e.jsx(a,{children:(parseFloat(t.cgst)+parseFloat(t.sgst)).toFixed(2)}),e.jsx(a,{children:t.totalPrice}),e.jsx(a,{children:t.totalPriceWithGST}),e.jsx(a,{children:t.fromName}),e.jsx(a,{children:`${t.address}, ${t.street}, ${t.city}, ${t.state}, ${t.pinCode}`}),e.jsxs(a,{children:[e.jsx(z,{onClick:()=>pe(t),color:"primary",children:e.jsx(ee,{})}),e.jsx(z,{onClick:()=>ye(t.id),color:"secondary",children:e.jsx(K,{})})]})]},t.id))})]})}),e.jsx(Oe,{count:Te,page:T,onChange:be,style:{marginTop:"20px",display:"flex",justifyContent:"center"}}),e.jsx($e,{open:ie,autoHideDuration:6e3,onClose:w,children:e.jsx(we,{onClose:w,severity:ce,sx:{width:"100%"},children:oe})}),e.jsxs(H,{open:re,onClose:D,children:[e.jsx(V,{children:S?"Edit Purchase":"New Purchase"}),e.jsxs(Q,{children:[e.jsx(qe,{options:k,getOptionLabel:t=>t.pro_name,renderInput:t=>e.jsx(n,{...t,label:"Product Name",variant:"outlined"}),onChange:(t,l)=>{u(l?o=>({...o,productName:l.pro_name,productId:l.pro_id}):o=>({...o,productName:"",productId:""}))},value:k.find(t=>t.pro_name===r.productName)||null,fullWidth:!0,margin:"normal"}),e.jsx(n,{label:"Specification",name:"specification",value:r.specification,onChange:i,fullWidth:!0,margin:"normal"}),e.jsx(n,{label:"Quantity",name:"quantity",value:r.quantity,onChange:i,type:"number",fullWidth:!0,margin:"normal"}),e.jsx(n,{label:"Price Per Piece",name:"price",value:r.price,onChange:i,type:"number",fullWidth:!0,margin:"normal"}),e.jsx(n,{label:"GST (%)",name:"gst",value:r.gst,onChange:i,type:"number",fullWidth:!0,margin:"normal"}),e.jsx(n,{label:"CGST",name:"cgst",value:r.cgst,onChange:i,type:"number",fullWidth:!0,margin:"normal"}),e.jsx(n,{label:"SGST",name:"sgst",value:r.sgst,onChange:i,type:"number",fullWidth:!0,margin:"normal"}),e.jsx(n,{label:"Total Price Without GST",name:"totalPrice",value:r.totalPrice,readOnly:!0,fullWidth:!0,margin:"normal"}),e.jsx(n,{label:"Total Price With GST",name:"totalPriceWithGST",value:r.totalPriceWithGST,readOnly:!0,fullWidth:!0,margin:"normal"}),e.jsx(n,{label:"From Name",name:"fromName",value:r.fromName,onChange:i,fullWidth:!0,margin:"normal"}),e.jsx(n,{label:"Address",name:"address",value:r.address,onChange:i,fullWidth:!0,margin:"normal"}),e.jsx(n,{label:"Street",name:"street",value:r.street,onChange:i,fullWidth:!0,margin:"normal"}),e.jsx(n,{label:"City",name:"city",value:r.city,onChange:i,fullWidth:!0,margin:"normal"}),e.jsx(n,{label:"State",name:"state",value:r.state,onChange:i,fullWidth:!0,margin:"normal"}),e.jsx(n,{label:"Pin Code",name:"pinCode",value:r.pinCode,onChange:i,fullWidth:!0,margin:"normal"})]}),e.jsxs(X,{children:[e.jsx(p,{onClick:D,color:"primary",children:"Cancel"}),e.jsx(p,{onClick:fe,color:"primary",children:S?"Update":"Submit"})]})]}),e.jsxs(H,{open:de,onClose:f,children:[e.jsx(V,{children:"Confirm Deletion"}),e.jsx(Q,{children:e.jsx(R,{children:"Are you sure you want to delete this purchase?"})}),e.jsxs(X,{children:[e.jsx(p,{onClick:f,color:"primary",children:"Cancel"}),e.jsx(p,{onClick:Pe,color:"secondary",children:"Delete"})]})]})]})};export{Ze as default};
