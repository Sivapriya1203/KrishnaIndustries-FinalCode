import{r as o,c as C,d as S,j as e,G as r,a4 as g,X as O,Y as xe,Z as B,$ as z,a0 as p,a1 as i,a2 as M,h as u,U as $,V as H,W as U,ai as me,T as s,a3 as Q,a7 as je,a5 as K,a6 as ge,a9 as pe,ah as ve,aj as ye}from"./index-14iq4arv.js";const fe=()=>{const[D,V]=o.useState([]),[_,I]=o.useState([]),[A,Z]=o.useState(""),[x,q]=o.useState({from:"",to:""}),[n,v]=o.useState(null),[X,Y]=o.useState([]),[J,N]=o.useState(!1),[ee,y]=o.useState(!1),[m,w]=o.useState({courierName:"",deliveryCode:"",deliveryStatus:""}),T=o.useRef(null),te=sessionStorage.getItem("emp_id"),[ne,b]=o.useState(!1),[ie,P]=o.useState(""),[se,k]=o.useState("success"),re=["Pending","Shipped","In Transit","Delivered"],j={company:"Krishna Industry",phone:"9171585789",email:"email@example.com",address:"Sri Venkateshwara Industrial Estate, No. 338/D2C, Balaguru Garden West, Peelamedu, Opposite Fun Mall, Peelamedu, Near NISE School, Coimbatore, Tamil Nadu, India, 641004",gst:"33BLDPS3889N1ZB"};o.useEffect(()=>{C.get(`${S.apiUrl}/cust_purch/getCustomerInvoices`).then(t=>{V(t.data),I(t.data)}).catch(t=>{console.error("Error fetching customer and invoice data:",t)})},[te]);const ae=async()=>{if(D.length>0)try{const t=await C.get(`${S.apiUrl}/product/getProductData`);Y(t.data)}catch(t){console.error("Failed to fetch products:",t)}};o.useEffect(()=>{ae()},[n]);const f=t=>{w({...m,[t.target.name]:t.target.value})},le=t=>{Z(t.target.value),E(t.target.value,x.from,x.to)},F=t=>{const{name:a,value:c}=t.target,l={...x,[a]:c};q(l),E(A,l.from,l.to)},E=(t,a,c)=>{let l=D;if(t){const h=t.toLowerCase();l=l.filter(d=>d.leads_name.toLowerCase().includes(h)||d.leads_email.toLowerCase().includes(h)||d.leads_mobile.toLowerCase().includes(h)||d.invoice_number.toString().includes(h))}if(a&&c){const h=new Date(a),d=new Date(c);l=l.filter(ue=>{const G=new Date(ue.invoice_date);return G>=h&&G<=d})}I(l)},oe=t=>{v(t),N(!0)},W=()=>{N(!1),v(null)},ce=t=>{v(t),y(!0)},L=()=>{y(!1),v(null)},R=(t,a)=>{a!=="clickaway"&&b(!1)},de=()=>{if(n){const{courierName:t,deliveryCode:a,deliveryStatus:c}=m;C.post(`${S.apiUrl}/cust_purch/addDelivery`,{invoiceNumber:n.invoice_number,courierName:t,deliveryCode:a,deliveryStatus:c}).then(l=>{y(!1),w({courierName:"",deliveryCode:"",deliveryStatus:""}),P("Courier details added successfully!"),k("success"),b(!0)}).catch(l=>{console.error("Error adding courier details:",l),P("Error adding courier details."),k("error"),b(!0)})}},he=()=>{const t=new ve,a=20,c=15;ye(T.current,{scale:2}).then(l=>{const h=l.toDataURL("image/png");t.setFillColor(0,0,139),t.rect(0,0,t.internal.pageSize.width,a,"F"),t.setTextColor(255,255,255),t.setFontSize(12),t.setFont("Helvetica","bold"),t.text("Invoice Document",t.internal.pageSize.width/2,10,{align:"center",baseline:"middle"}),t.addImage(h,"PNG",10,a+5,190,0);const d=t.internal.pageSize.height;t.setFillColor(0,0,139),t.rect(0,d-c,t.internal.pageSize.width,c,"F"),t.setTextColor(255,255,255),t.setFontSize(10),t.text("© 2024 Krishna Industry | All rights reserved",t.internal.pageSize.width/2,d-5,{align:"center",baseline:"middle"}),t.save(`Invoice-${n.invoice_number}.pdf`)})};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-center",children:"Customer Purchase Index"}),e.jsxs(r,{container:!0,spacing:2,style:{padding:"20px"},children:[e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(g,{label:"Search",value:A,onChange:le,placeholder:"Search by name, email, mobile, or invoice number",fullWidth:!0})}),e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(g,{label:"From Date",type:"date",name:"from",value:x.from,onChange:F,fullWidth:!0,InputLabelProps:{shrink:!0}})}),e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(g,{label:"To Date",type:"date",name:"to",value:x.to,onChange:F,fullWidth:!0,InputLabelProps:{shrink:!0}})})]}),e.jsx(O,{component:xe,children:e.jsxs(B,{children:[e.jsx(z,{children:e.jsxs(p,{children:[e.jsx(i,{children:"S.No"}),e.jsx(i,{children:"Employee"}),e.jsx(i,{children:"Customer Name"}),e.jsx(i,{children:"Mobile"}),e.jsx(i,{children:"Email"}),e.jsx(i,{children:"Company"}),e.jsx(i,{children:"City"}),e.jsx(i,{children:"State"}),e.jsx(i,{children:"Invoice Number"}),e.jsx(i,{children:"Amount"}),e.jsx(i,{children:"Invoice Date"}),e.jsx(i,{children:"Actions"})]})}),e.jsx(M,{children:_.length>0?_.map((t,a)=>e.jsxs(p,{children:[e.jsx(i,{children:a+1}),e.jsx(i,{children:t.emp_name}),e.jsx(i,{children:t.leads_name}),e.jsx(i,{children:t.leads_mobile}),e.jsx(i,{children:t.leads_email}),e.jsx(i,{children:t.leads_company}),e.jsx(i,{children:t.leads_city}),e.jsx(i,{children:t.leads_state}),e.jsx(i,{children:t.invoice_number}),e.jsx(i,{children:t.total_with_tax}),e.jsx(i,{children:new Date(t.invoice_date).toLocaleDateString()}),e.jsxs(i,{children:[e.jsx(u,{variant:"contained",color:"primary",onClick:()=>oe(t),style:{marginRight:"10px"},children:"Show Invoice"}),e.jsx(u,{variant:"contained",color:"secondary",onClick:()=>ce(t),children:"Add Delivery"})]})]},a)):e.jsx(p,{children:e.jsx(i,{colSpan:10,align:"center",children:"No customer or invoice data found."})})})]})}),e.jsxs($,{open:J,onClose:W,maxWidth:"md",fullWidth:!0,children:[e.jsx(H,{children:"Invoice Preview"}),e.jsx(U,{dividers:!0,children:n?e.jsxs("div",{ref:T,style:{padding:"10px",backgroundColor:"#ffffff",borderRadius:"8px"},children:[e.jsxs(r,{container:!0,alignItems:"center",justifyContent:"space-between",children:[e.jsx(r,{item:!0,xs:3,children:e.jsx("img",{src:me,alt:"Company Logo",style:{width:"120px",height:"auto"}})}),e.jsxs(r,{item:!0,xs:6,style:{textAlign:"right"},children:[e.jsxs(s,{variant:"h6",children:["Invoice No: ",n.invoice_number]}),e.jsxs(s,{variant:"h6",children:["Date: ",new Date(n.invoice_date).toLocaleDateString()]}),e.jsxs(s,{variant:"h6",children:["Payment Type: ",n.payment_type]}),n.payment_type!=="Cash"&&e.jsxs(s,{variant:"h6",children:["Transaction Id: ",n.transactionId]})]})]}),e.jsxs(r,{container:!0,spacing:2,style:{paddingTop:"15px"},children:[e.jsxs(r,{item:!0,xs:6,style:{textAlign:"left"},children:[e.jsx(s,{variant:"h4",gutterBottom:!0,children:"From"}),e.jsx(s,{children:j.company}),e.jsxs(s,{children:["Phone: ",j.phone]}),e.jsxs(s,{children:["Email: ",j.email]}),e.jsxs(s,{children:["Address: ",j.address]}),e.jsxs(s,{children:["GST NO: ",j.gst]})]}),e.jsxs(r,{item:!0,xs:6,style:{textAlign:"left"},children:[e.jsx(s,{variant:"h4",gutterBottom:!0,children:"To"}),e.jsx(s,{children:n.leads_name}),e.jsxs(s,{children:["Company: ",n.leads_company]}),e.jsxs(s,{children:["Phone: ",n.leads_mobile]}),e.jsxs(s,{children:["Email: ",n.leads_email]}),e.jsxs(s,{children:["GST No: ",n.gst_number]})]})]}),e.jsxs(r,{container:!0,spacing:3,style:{borderWidth:"2px",borderColor:"black",paddingTop:"15px"},children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx(s,{variant:"h4",children:"Billing Address"}),e.jsxs(s,{variant:"h6",children:[n.billing_door_number||"N/A",",",e.jsx("br",{})," ",n.billing_street||"N/A",","," ",n.billing_landMark||"N/A",", ",e.jsx("br",{}),n.billing_city||"N/A",",",e.jsx("br",{})," ",n.billing_state||"N/A"," -"," ",n.billing_pincode||"N/A"]})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx(s,{variant:"h4",children:"Shipping Address"}),e.jsxs(s,{variant:"h6",children:[n.billing_door_number||"N/A",", ",e.jsx("br",{}),n.billing_street||"N/A",", ",n.billing_landMark||"N/A",", ",e.jsx("br",{}),n.billing_city||"N/A",", ",e.jsx("br",{}),n.billing_state||"N/A"," - ",n.billing_pincode||"N/A"]})]})]}),e.jsx(O,{style:{marginTop:"20px"},children:e.jsxs(B,{children:[e.jsx(z,{children:e.jsxs(p,{children:[e.jsx(i,{children:"Product"}),e.jsx(i,{children:"Quantity"}),e.jsx(i,{children:"Price"}),e.jsx(i,{children:"Sub Total"})]})}),e.jsx(M,{children:n.product_details.map((t,a)=>{const c=X.find(l=>l.pro_id===t.pro_id);return e.jsxs(p,{children:[e.jsx(i,{children:c?c.pro_name:"Unknown Product"}),e.jsx(i,{children:t.quantity}),e.jsx(i,{children:t.price}),e.jsx(i,{children:parseFloat(t.price)*parseInt(t.quantity)})]},a)})})]})}),e.jsxs(r,{item:!0,xs:6,sm:3,margin:"15px",marginTop:"20px",children:[e.jsx(s,{variant:"h4",align:"right",margin:"3px",children:"Totals Section"}),e.jsxs(r,{container:!0,direction:"column",children:[e.jsxs(r,{item:!0,container:!0,justifyContent:"space-between",children:[e.jsx(s,{variant:"h6",style:{textAlign:"right",flex:1},children:"Total (without tax)"}),e.jsx(s,{variant:"h6",style:{textAlign:"right",flex:.1},children:n.total_without_tax})]}),e.jsxs(r,{item:!0,container:!0,justifyContent:"space-between",children:[e.jsx(s,{variant:"h6",style:{textAlign:"right",flex:1},children:"Discount"}),e.jsx(s,{variant:"h6",style:{textAlign:"right",flex:.1},children:n.discountType==="percentage"?`${n.discount}%`:`₹${n.discount}`})]}),e.jsxs(r,{item:!0,container:!0,justifyContent:"space-between",children:[e.jsx(s,{variant:"h6",style:{textAlign:"right",flex:1},children:"GST"}),e.jsxs(s,{variant:"h6",style:{textAlign:"right",flex:.1},children:[n.gst,"%"]})]}),e.jsxs(r,{item:!0,container:!0,justifyContent:"space-between",children:[e.jsx(s,{variant:"h4",style:{textAlign:"right",flex:1},children:"Total (with tax)"}),e.jsx(s,{variant:"h4",style:{textAlign:"right",flex:.1},children:n.total_with_tax})]})]})]})]}):e.jsx(s,{children:"No invoice data available."})}),e.jsxs(Q,{children:[e.jsx(u,{onClick:W,children:"Close"}),e.jsx(u,{onClick:he,color:"primary",children:"Generate PDF"})]})]}),e.jsxs($,{open:ee,onClose:L,maxWidth:"sm",fullWidth:!0,children:[e.jsx(H,{children:"Add Delivery Details"}),e.jsx(U,{children:e.jsxs("div",{children:[e.jsxs(s,{variant:"h6",children:["Invoice No: ",n==null?void 0:n.invoice_number]}),e.jsx(g,{label:"Courier Name",name:"courierName",value:m.courierName,onChange:f,fullWidth:!0,margin:"normal"}),e.jsx(g,{label:"Delivery Code",name:"deliveryCode",value:m.deliveryCode,onChange:f,fullWidth:!0,margin:"normal"}),e.jsxs(je,{label:"Delivery Status",name:"deliveryStatus",value:m.deliveryStatus,onChange:f,fullWidth:!0,displayEmpty:!0,margin:"normal",children:[e.jsx(K,{value:"",disabled:!0,children:"Select Status"}),re.map(t=>e.jsx(K,{value:t,children:t},t))]})]})}),e.jsxs(Q,{children:[e.jsx(u,{onClick:L,children:"Cancel"}),e.jsx(u,{onClick:de,color:"primary",children:"Submit"})]})]}),e.jsx(ge,{open:ne,autoHideDuration:4e3,onClose:R,children:e.jsx(pe,{onClose:R,severity:se,children:ie})})]})};export{fe as default};
