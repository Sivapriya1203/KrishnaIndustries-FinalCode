import{r as l,j as e,G as n,a4 as h,a5 as f,h as p,c as ee,d as se,ab as Ee,B as Fe,F as Ye,a7 as Ue,X as Ne,Y as Re,Z as Me,$ as Ae,a0 as J,a1 as d,a2 as Oe,S as Ie,a6 as $e,a9 as Be,U as k,W,a3 as P,as as ze,V as Ve}from"./index-14iq4arv.js";import{h as T}from"./moment-G82_0lEo.js";import{T as qe,a as K,U as Qe}from"./UpdateFlwLeads-l02mNBDA.js";import{C as Ge}from"./ConvertCustomer-BHykrH44.js";import{P as He}from"./Pagination-Drt3pWZO.js";const Xe=({onClose:E,data:a})=>{const[i,O]=l.useState({leads_name:a?a.leads_name:"",leads_mobile:a?a.leads_mobile:"",leads_email:a?a.leads_email:"",leads_company:a?a.leads_company:"",leads_address:a?a.leads_address:"",leads_state:a?a.leads_state:"",leads_city:a?a.leads_city:"",product_name:a?a.product_name:"",Call_Discussion:a?a.Call_Discussion:"",remember:a?a.remember:"",reminder_date:a?a.reminder_date:""}),[g,F]=l.useState({Call_Discussion:"",remember:"",reminder_date:""}),y=(j,u)=>{let o="";const x=u&&typeof u=="string"?u.trim():u;switch(j){case"Call_Discussion":x||(o="Leads Query Message is Required");break;case"remember":x?x==="yes"&&!i.reminder_date&&(o="Reminder Date is Required"):o="Please Select one";break}return o},c=j=>{const{name:u,value:o}=j.target,x=y(u,o);O({...i,[u]:o}),F({...g,[u]:x})},b=j=>{j.preventDefault();let u={};Object.keys(i).forEach(o=>{const x=i[o],D=y(o,x);D&&(u[o]=D)}),Object.keys(u).length>0&&F(u),ee.put(`${se.apiUrl}/leads/updateFlwLeadForEmp/${a.follow_id}`,i).then(o=>{console.log("Data Added Successfully.",o),E()}).catch(o=>{console.log("Data is not added",o)})};return e.jsx("div",{children:e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,name:"leads_name",label:"Lead Name",value:i.leads_name,onChange:c})}),e.jsx(n,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,name:"leads_mobile",label:"Lead Mobile",value:i.leads_mobile,onChange:c})}),e.jsx(n,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,name:"leads_email",label:"Lead Email",value:i.leads_email,onChange:c})}),e.jsx(n,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,name:"leads_company",label:"Lead Company",value:i.leads_company,onChange:c})}),e.jsx(n,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,name:"leads_address",label:"Lead Address",value:i.leads_address,onChange:c})}),e.jsx(n,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,name:"leads_state",label:"Lead State",value:i.leads_state,onChange:c})}),e.jsx(n,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,name:"leads_city",label:"Lead City",value:i.leads_city,onChange:c})}),e.jsx(n,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,name:"product_name",label:"Product Name",value:i.product_name,onChange:c})}),e.jsx(n,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,name:"Call_Discussion",label:"Leads Query",value:i.Call_Discussion,onChange:c,error:!!g.Call_Discussion,helperText:g.Call_Discussion})}),e.jsx(n,{item:!0,xs:6,children:e.jsxs(h,{fullWidth:!0,select:!0,name:"remember",label:"Remember",value:i.remember,onChange:c,error:!!g.remember,helperText:g.remember,children:[e.jsx(f,{value:"Yes",children:"Yes"}),e.jsx(f,{value:"No",children:"No"})]})}),i.remember==="Yes"&&e.jsx(n,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,name:"reminder_date",label:"Reminder Date",type:"date",value:i.reminder_date,onChange:c,error:!!g.reminder_date,helperText:g.reminder_date,InputLabelProps:{shrink:!0}})}),e.jsx(n,{item:!0,xs:12,display:"flex",justifyContent:"center",children:e.jsx(p,{onClick:b,children:"Submit"})})]})})},ns=()=>{const E=Ee(),[a,i]=l.useState([]),[O,g]=l.useState(null),[F,y]=l.useState(null),[c,b]=l.useState([]),[j,u]=l.useState(5),[o,x]=l.useState(1),[D,te]=l.useState([]),[ae,I]=l.useState([]),[C,$]=l.useState(""),[S,B]=l.useState(""),[_,z]=l.useState(""),le=sessionStorage.getItem("emp_id"),[v,ne]=l.useState(1),[V,w]=l.useState(!1),[q,L]=l.useState(!1),[Q,Ze]=l.useState([]),[re,G]=l.useState([]),[ie,Y]=l.useState(!1),[de,Je]=l.useState([]),[oe,U]=l.useState(!1),[ce,Ke]=l.useState([]),[ue,N]=l.useState(!1),[he,H]=l.useState(""),[xe,X]=l.useState("success"),[R,me]=l.useState(""),[M,pe]=l.useState("");l.useEffect(()=>{ee.get(`${se.apiUrl}/leads/followingLeadsByEmpId?emp_id=${le}`).then(s=>{const t=new Set(s.data.map(r=>r.leads_state));te([...t]),i(s.data),b(s.data)}).catch(s=>{console.log("Leads data is not fetched.",s)})},[V,Q,q]),l.useEffect(()=>{if(C){const s=new Set(a.filter(t=>t.leads_state===C).map(t=>t.leads_city));I([...s])}else I([])},[C]),l.useEffect(()=>{const s=T().format("YYYY-MM-DD"),t=a.filter(r=>{const m=_===""||r.leads_name.toLowerCase().includes(_.toLowerCase())||r.leads_name.toUpperCase().includes(_.toUpperCase)||r.leads_email.toLowerCase().includes(_.toLowerCase())||r.leads_email.toUpperCase().includes(_.toUpperCase())||r.leads_mobile.includes(_),A=C===""||r.leads_state===C,Pe=S===""||r.leads_city===S,Te=v===1||v===2&&T(r.created_at).format("YYYY-MM-DD")===s;return m&&A&&Pe&&Te});b(t)},[_,C,S,v,a]);const je=s=>{const t=parseInt(s.target.value,10);t==1?(u(a.length),x(1)):(u(t),x(1))},fe=(o-1)*j,ge=o*j,Ce=c?c.slice(fe,ge):[],_e=()=>{$(""),B(""),z(""),b(a)},be=s=>{const t=a.find(r=>r.follow_id===s);t&&(G(t),w(!0))},ye=s=>{G(""),L(!0)},De=()=>{g(null),y(null)},Se=(s,t)=>{De(),E(`/${s}/${t}`)},Z=()=>{N(!1)},ve=()=>{L(!1),X("success"),H(" New Lead created successfully"),N(!0)},we=s=>{const t=a.filter(m=>m.follow_id!==s),r=c.filter(m=>m.follow_id!==s);i(t),b(r),X("success"),H("Lead removed successfully!"),N(!0)},Le=()=>a.filter(t=>{if(R&&M){const r=T(t.created_at).format("YYYY-MM-DD");return r>=R&&r<=M}return!0}),ke=()=>{const s=Le(),t=We(s),r=new Blob([t],{type:"text/csv"}),m=document.createElement("a");m.href=URL.createObjectURL(r),m.download="filtered_data.csv",m.click()},We=s=>{const t=["follow_id","emp_id","emp_name","leads_id","leads_name","leads_mobile","leads_email","product_name","leads_company","Description","Call_Discussion","remember","reminder_date","leads_address","leads_state","leads_city","call_Attended","gst_number","created_at"],r=s.map(m=>t.map(A=>m[A]||"").join(","));return`${t.join(",")}
${r.join(`
`)}`};return e.jsxs("div",{style:{padding:"10px"},children:[e.jsx("h1",{className:"text-center",children:"Followed Leads Index"}),e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{item:!0,xs:8,children:e.jsx(Fe,{sx:{width:"100%",bgcolor:"background.paper"},children:e.jsxs(qe,{value:v,onChange:(s,t)=>ne(t),centered:!0,children:[e.jsx(K,{label:"All Leads",value:1}),e.jsx(K,{label:"Today's Leads",value:2})]})})}),e.jsx(n,{item:!0,xs:4,display:"flex",justifyContent:"end",children:e.jsx(p,{variant:"outlined",onClick:_e,children:"Cancel Filters"})})]}),e.jsx(p,{onClick:()=>ye(),children:"New walking leads"}),e.jsxs(n,{container:!0,spacing:3,style:{marginTop:"20px"},children:[e.jsx(n,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,label:"Search",placeholder:"Search by name, email, or mobile",onChange:s=>z(s.target.value),value:_})}),e.jsx(n,{item:!0,xs:6,children:e.jsx(Ye,{fullWidth:!0,children:e.jsxs(Ue,{value:j,onChange:je,children:[e.jsx(f,{value:5,children:"5 Per Page"}),e.jsx(f,{value:10,children:"10 Per Page"}),e.jsx(f,{value:15,children:"15 Per Page"}),e.jsx(f,{value:1,children:"All Per Page"})]})})})]}),e.jsxs(n,{container:!0,spacing:3,style:{marginTop:"20px"},children:[e.jsx(n,{item:!0,xs:6,children:e.jsxs(h,{fullWidth:!0,select:!0,label:"Select State",value:C,onChange:s=>$(s.target.value),children:[e.jsx(f,{value:"",children:"All States"}),D.map((s,t)=>e.jsx(f,{value:s,children:s},t))]})}),e.jsx(n,{item:!0,xs:6,children:e.jsxs(h,{fullWidth:!0,select:!0,label:"Select City",value:S,onChange:s=>B(s.target.value),disabled:!C,children:[e.jsx(f,{value:"",children:"All Cities"}),ae.map((s,t)=>e.jsx(f,{value:s,children:s},t))]})})]}),e.jsxs("div",{style:{padding:"20px",border:"1px solid #ddd",borderRadius:"8px",backgroundColor:"#f9f9f9"},children:[e.jsx("h3",{style:{textAlign:"center",padding:"10px",color:"red"},children:" Daily Reports Download"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginBottom:"15px",justifyContent:"center"},children:[e.jsx("label",{style:{fontWeight:"bold",fontSize:"14px"},children:"Start Date:"}),e.jsx("input",{type:"date",value:R,onChange:s=>me(s.target.value),style:{padding:"8px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px"}}),e.jsx("label",{style:{fontWeight:"bold",fontSize:"14px"},children:"End Date:"}),e.jsx("input",{type:"date",value:M,onChange:s=>pe(s.target.value),style:{padding:"8px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px"}})]}),e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:"15px"},children:e.jsx(p,{variant:"contained",color:"primary",onClick:ke,style:{padding:"10px 20px",fontWeight:"bold",borderRadius:"6px",backgroundColor:"#007bff",color:"#fff"},children:"Download Data"})})]}),e.jsx(Ne,{component:Re,style:{marginTop:"20px"},children:e.jsxs(Me,{children:[e.jsx(Ae,{children:e.jsxs(J,{style:{fontWeight:"bold",backgroundColor:"#FFF9C4"},children:[e.jsx(d,{children:"S.No"}),e.jsx(d,{children:"Employee Name"}),e.jsx(d,{children:"Leads Name"}),e.jsx(d,{children:"Leads Mobile"}),e.jsx(d,{children:"Leads Email"}),e.jsx(d,{children:"Leads Company"}),e.jsx(d,{children:"State"}),e.jsx(d,{children:"City"}),e.jsx(d,{children:"Reminder Date"}),e.jsx(d,{children:"Action"})]})}),e.jsx(Oe,{children:Ce.map((s,t)=>e.jsxs(J,{children:[e.jsx(d,{children:t+1}),e.jsx(d,{children:s.emp_name}),e.jsx(d,{children:s.leads_name}),e.jsx(d,{children:s.leads_mobile}),e.jsx(d,{children:s.leads_email}),e.jsx(d,{children:s.leads_company}),e.jsx(d,{children:s.leads_state}),e.jsx(d,{children:s.leads_city}),e.jsx(d,{children:T(s.reminder_date).format("YYYY-MM-DD")}),e.jsxs(d,{children:[e.jsx(p,{variant:"outlined",onClick:()=>Se("quotation",s.follow_id),children:"Quotation"}),e.jsx(p,{onClick:()=>be(s.follow_id),children:"Edit"}),e.jsx(p,{variant:"outlined",onClick:()=>we(s.follow_id),children:"Remove"})]})]},t))})]})}),e.jsx(n,{container:!0,spacing:2,display:"flex",justifyContent:"center",className:"mt-4",children:e.jsx(Ie,{spacing:2,children:e.jsx(He,{count:Math.ceil(c.length/j),page:o,onChange:(s,t)=>x(t),size:"small"})})}),e.jsx($e,{open:ue,autoHideDuration:3e3,onClose:Z,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(Be,{onClose:Z,severity:xe,sx:{width:"100%"},children:he})}),e.jsxs(k,{open:V,onClose:()=>w(!1),maxWidth:"md",children:[e.jsx(W,{children:e.jsx(Qe,{data:re,onClose:()=>w(!1)})}),e.jsx(P,{children:e.jsx(p,{onClick:()=>w(!1),children:"Close"})})]}),e.jsxs(k,{open:q,onClose:()=>L(!1),maxWidth:"md",children:[e.jsx(W,{children:e.jsx(ze,{data:Q,onSuccess:ve})}),e.jsx(P,{children:e.jsx(p,{onClick:()=>L(!1),children:"Close"})})]}),e.jsxs(k,{open:ie,onClose:()=>Y(!1),maxWidth:"md",children:[e.jsx(Ve,{children:"Edit"}),e.jsx(W,{children:e.jsx(Xe,{data:de,onClose:()=>Y(!1)})}),e.jsx(P,{children:e.jsx(p,{onClick:()=>Y(!1),children:"Close"})})]}),e.jsxs(k,{open:oe,onClose:()=>U(!1),maxWidth:"md",children:[e.jsx(W,{children:e.jsx(Ge,{data:ce,onClose:()=>U(!1)})}),e.jsx(P,{children:e.jsx(p,{onClick:()=>U(!1),children:"Close"})})]})]})};export{ns as default};
