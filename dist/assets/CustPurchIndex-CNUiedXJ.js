import{r as o,c as C,d as S,j as e,G as r,a4 as g,X as B,Y as xe,Z as $,$ as z,a0 as p,a1 as s,a2 as M,h as u,U as H,V as U,W as Q,ai as me,T as i,a3 as K,a7 as je,a5 as V,a6 as ge,a9 as pe,ah as ve,aj as ye}from"./index-14iq4arv.js";const fe=()=>{const[D,Z]=o.useState([]),[_,I]=o.useState([]),[A,q]=o.useState(""),[x,X]=o.useState({from:"",to:""}),[n,v]=o.useState(null),[Y,J]=o.useState([]),[ee,N]=o.useState(!1),[te,y]=o.useState(!1),[m,w]=o.useState({courierName:"",deliveryCode:"",deliveryStatus:""}),T=o.useRef(null),k=sessionStorage.getItem("emp_id"),[ne,b]=o.useState(!1),[ie,P]=o.useState(""),[se,F]=o.useState("success"),re=["Pending","Shipped","In Transit","Delivered"],j={company:"Krishna Industry",phone:"9171585789",email:"email@example.com",address:"Sri Venkateshwara Industrial Estate, No. 338/D2C, Balaguru Garden West, Peelamedu, Opposite Fun Mall, Peelamedu, Near NISE School, Coimbatore, Tamil Nadu, India, 641004",gst:"33BLDPS3889N1ZB"};o.useEffect(()=>{C.get(`${S.apiUrl}/cust_purch/getCustomerInvoices/${k}`).then(t=>{Z(t.data),I(t.data)}).catch(t=>{console.error("Error fetching customer and invoice data:",t)})},[k]);const ae=async()=>{if(D.length>0)try{const t=await C.get(`${S.apiUrl}/product/getProductData`);J(t.data)}catch(t){console.error("Failed to fetch products:",t)}};o.useEffect(()=>{ae()},[n]);const f=t=>{w({...m,[t.target.name]:t.target.value})},le=t=>{q(t.target.value),W(t.target.value,x.from,x.to)},E=t=>{const{name:l,value:c}=t.target,a={...x,[l]:c};X(a),W(A,a.from,a.to)},W=(t,l,c)=>{let a=D;if(t){const h=t.toLowerCase();a=a.filter(d=>d.leads_name.toLowerCase().includes(h)||d.leads_email.toLowerCase().includes(h)||d.leads_mobile.toLowerCase().includes(h)||d.invoice_number.toString().includes(h))}if(l&&c){const h=new Date(l),d=new Date(c);a=a.filter(ue=>{const O=new Date(ue.invoice_date);return O>=h&&O<=d})}I(a)},oe=t=>{v(t),N(!0)},L=()=>{N(!1),v(null)},ce=t=>{v(t),y(!0)},R=()=>{y(!1),v(null)},G=(t,l)=>{l!=="clickaway"&&b(!1)},de=()=>{if(n){const{courierName:t,deliveryCode:l,deliveryStatus:c}=m;C.post(`${S.apiUrl}/cust_purch/addDelivery`,{invoiceNumber:n.invoice_number,courierName:t,deliveryCode:l,deliveryStatus:c}).then(a=>{y(!1),w({courierName:"",deliveryCode:"",deliveryStatus:""}),P("Courier details added successfully!"),F("success"),b(!0)}).catch(a=>{console.error("Error adding courier details:",a),P("Error adding courier details."),F("error"),b(!0)})}},he=()=>{const t=new ve,l=20,c=15;ye(T.current,{scale:2}).then(a=>{const h=a.toDataURL("image/png");t.setFillColor(0,0,139),t.rect(0,0,t.internal.pageSize.width,l,"F"),t.setTextColor(255,255,255),t.setFontSize(12),t.setFont("Helvetica","bold"),t.text("Invoice Document",t.internal.pageSize.width/2,10,{align:"center",baseline:"middle"}),t.addImage(h,"PNG",10,l+5,190,0);const d=t.internal.pageSize.height;t.setFillColor(0,0,139),t.rect(0,d-c,t.internal.pageSize.width,c,"F"),t.setTextColor(255,255,255),t.setFontSize(10),t.text("© 2024 Krishna Industry | All rights reserved",t.internal.pageSize.width/2,d-5,{align:"center",baseline:"middle"}),t.save(`Invoice-${n.invoice_number}.pdf`)})};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-center",children:"Customer Purchase Index"}),e.jsxs(r,{container:!0,spacing:2,style:{padding:"20px"},children:[e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(g,{label:"Search",value:A,onChange:le,placeholder:"Search by name, email, mobile, or invoice number",fullWidth:!0})}),e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(g,{label:"From Date",type:"date",name:"from",value:x.from,onChange:E,fullWidth:!0,InputLabelProps:{shrink:!0}})}),e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(g,{label:"To Date",type:"date",name:"to",value:x.to,onChange:E,fullWidth:!0,InputLabelProps:{shrink:!0}})})]}),e.jsx(B,{component:xe,children:e.jsxs($,{children:[e.jsx(z,{children:e.jsxs(p,{children:[e.jsx(s,{children:"Customer Name"}),e.jsx(s,{children:"Mobile"}),e.jsx(s,{children:"Email"}),e.jsx(s,{children:"Company"}),e.jsx(s,{children:"City"}),e.jsx(s,{children:"State"}),e.jsx(s,{children:"Invoice Number"}),e.jsx(s,{children:"Amount"}),e.jsx(s,{children:"Invoice Date"}),e.jsx(s,{children:"Actions"})]})}),e.jsx(M,{children:_.length>0?_.map((t,l)=>e.jsxs(p,{children:[e.jsx(s,{children:t.leads_name}),e.jsx(s,{children:t.leads_mobile}),e.jsx(s,{children:t.leads_email}),e.jsx(s,{children:t.leads_company}),e.jsx(s,{children:t.leads_city}),e.jsx(s,{children:t.leads_state}),e.jsx(s,{children:t.invoice_number}),e.jsx(s,{children:t.total_with_tax}),e.jsx(s,{children:new Date(t.invoice_date).toLocaleDateString()}),e.jsxs(s,{children:[e.jsx(u,{variant:"contained",color:"primary",onClick:()=>oe(t),style:{marginRight:"10px"},children:"Show Invoice"}),e.jsx(u,{variant:"contained",color:"secondary",onClick:()=>ce(t),children:"Add Delivery"})]})]},l)):e.jsx(p,{children:e.jsx(s,{colSpan:10,align:"center",children:"No customer or invoice data found."})})})]})}),e.jsxs(H,{open:ee,onClose:L,maxWidth:"md",fullWidth:!0,children:[e.jsx(U,{children:"Invoice Preview"}),e.jsx(Q,{dividers:!0,children:n?e.jsxs("div",{ref:T,style:{padding:"10px",backgroundColor:"#ffffff",borderRadius:"8px"},children:[e.jsxs(r,{container:!0,alignItems:"center",justifyContent:"space-between",children:[e.jsx(r,{item:!0,xs:3,children:e.jsx("img",{src:me,alt:"Company Logo",style:{width:"120px",height:"auto"}})}),e.jsxs(r,{item:!0,xs:6,style:{textAlign:"right"},children:[e.jsxs(i,{variant:"h6",children:["Invoice No: ",n.invoice_number]}),e.jsxs(i,{variant:"h6",children:["Date: ",new Date(n.invoice_date).toLocaleDateString()]}),e.jsxs(i,{variant:"h6",children:["Payment Type: ",n.payment_type]}),n.payment_type!=="Cash"&&e.jsxs(i,{variant:"h6",children:["Transaction Id: ",n.transactionId]})]})]}),e.jsxs(r,{container:!0,spacing:2,style:{paddingTop:"15px"},children:[e.jsxs(r,{item:!0,xs:6,style:{textAlign:"left"},children:[e.jsx(i,{variant:"h4",gutterBottom:!0,children:"From"}),e.jsx(i,{children:j.company}),e.jsxs(i,{children:["Phone: ",j.phone]}),e.jsxs(i,{children:["Email: ",j.email]}),e.jsxs(i,{children:["Address: ",j.address]}),e.jsxs(i,{children:["GST NO: ",j.gst]})]}),e.jsxs(r,{item:!0,xs:6,style:{textAlign:"left"},children:[e.jsx(i,{variant:"h4",gutterBottom:!0,children:"To"}),e.jsx(i,{children:n.leads_name}),e.jsxs(i,{children:["Company: ",n.leads_company]}),e.jsxs(i,{children:["Phone: ",n.leads_mobile]}),e.jsxs(i,{children:["Email: ",n.leads_email]}),e.jsxs(i,{children:["GST No: ",n.gst_number]})]})]}),e.jsxs(r,{container:!0,spacing:3,style:{borderWidth:"2px",borderColor:"black",paddingTop:"15px"},children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx(i,{variant:"h4",children:"Billing Address"}),e.jsxs(i,{variant:"h6",children:[n.billing_door_number||"N/A",",",e.jsx("br",{})," ",n.billing_street||"N/A",","," ",n.billing_landMark||"N/A",", ",e.jsx("br",{}),n.billing_city||"N/A",",",e.jsx("br",{})," ",n.billing_state||"N/A"," -"," ",n.billing_pincode||"N/A"]})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx(i,{variant:"h4",children:"Shipping Address"}),e.jsxs(i,{variant:"h6",children:[n.billing_door_number||"N/A",", ",e.jsx("br",{}),n.billing_street||"N/A",", ",n.billing_landMark||"N/A",", ",e.jsx("br",{}),n.billing_city||"N/A",", ",e.jsx("br",{}),n.billing_state||"N/A"," - ",n.billing_pincode||"N/A"]})]})]}),e.jsx(B,{style:{marginTop:"20px"},children:e.jsxs($,{children:[e.jsx(z,{children:e.jsxs(p,{children:[e.jsx(s,{children:"Product"}),e.jsx(s,{children:"Quantity"}),e.jsx(s,{children:"Price"}),e.jsx(s,{children:"Sub Total"})]})}),e.jsx(M,{children:n.product_details.map((t,l)=>{const c=Y.find(a=>a.pro_id===t.pro_id);return e.jsxs(p,{children:[e.jsx(s,{children:c?c.pro_name:"Unknown Product"}),e.jsx(s,{children:t.quantity}),e.jsx(s,{children:t.price}),e.jsx(s,{children:parseFloat(t.price)*parseInt(t.quantity)})]},l)})})]})}),e.jsxs(r,{item:!0,xs:6,sm:3,margin:"15px",marginTop:"20px",children:[e.jsx(i,{variant:"h4",align:"right",margin:"3px",children:"Totals Section"}),e.jsxs(r,{container:!0,direction:"column",children:[e.jsxs(r,{item:!0,container:!0,justifyContent:"space-between",children:[e.jsx(i,{variant:"h6",style:{textAlign:"right",flex:1},children:"Total (without tax)"}),e.jsx(i,{variant:"h6",style:{textAlign:"right",flex:.1},children:n.total_without_tax})]}),e.jsxs(r,{item:!0,container:!0,justifyContent:"space-between",children:[e.jsx(i,{variant:"h6",style:{textAlign:"right",flex:1},children:"Discount"}),e.jsx(i,{variant:"h6",style:{textAlign:"right",flex:.1},children:n.discountType==="percentage"?`${n.discount}%`:`₹${n.discount}`})]}),e.jsxs(r,{item:!0,container:!0,justifyContent:"space-between",children:[e.jsx(i,{variant:"h6",style:{textAlign:"right",flex:1},children:"GST"}),e.jsxs(i,{variant:"h6",style:{textAlign:"right",flex:.1},children:[n.gst,"%"]})]}),e.jsxs(r,{item:!0,container:!0,justifyContent:"space-between",children:[e.jsx(i,{variant:"h4",style:{textAlign:"right",flex:1},children:"Total (with tax)"}),e.jsx(i,{variant:"h4",style:{textAlign:"right",flex:.1},children:n.total_with_tax})]})]})]})]}):e.jsx(i,{children:"No invoice data available."})}),e.jsxs(K,{children:[e.jsx(u,{onClick:L,children:"Close"}),e.jsx(u,{onClick:he,color:"primary",children:"Generate PDF"})]})]}),e.jsxs(H,{open:te,onClose:R,maxWidth:"sm",fullWidth:!0,children:[e.jsx(U,{children:"Add Delivery Details"}),e.jsx(Q,{children:e.jsxs("div",{children:[e.jsxs(i,{variant:"h6",children:["Invoice No: ",n==null?void 0:n.invoice_number]}),e.jsx(g,{label:"Courier Name",name:"courierName",value:m.courierName,onChange:f,fullWidth:!0,margin:"normal"}),e.jsx(g,{label:"Delivery Code",name:"deliveryCode",value:m.deliveryCode,onChange:f,fullWidth:!0,margin:"normal"}),e.jsxs(je,{label:"Delivery Status",name:"deliveryStatus",value:m.deliveryStatus,onChange:f,fullWidth:!0,displayEmpty:!0,margin:"normal",children:[e.jsx(V,{value:"",disabled:!0,children:"Select Status"}),re.map(t=>e.jsx(V,{value:t,children:t},t))]})]})}),e.jsxs(K,{children:[e.jsx(u,{onClick:R,children:"Cancel"}),e.jsx(u,{onClick:de,color:"primary",children:"Submit"})]})]}),e.jsx(ge,{open:ne,autoHideDuration:4e3,onClose:G,children:e.jsx(pe,{onClose:G,severity:se,children:ie})})]})};export{fe as default};
